# AlgoKit CLI for contributors

## Commits

We are using the [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/#summary) standard for commit messages. This allows us to automatically generate release notes and version numbers. We do this via [Python Semantic Release](https://python-semantic-release.readthedocs.io/en/latest/) and [GitHub actions](.github/workflows/cd.yaml).

## Guiding Principles

AlgoKit development is done within the [AlgoKit Guiding Principles](./docs/algokit.md#guiding-principles).

## Setup (AlgoKit CLI development)

### Initial setup

1. Clone this repository: `git clone https://github.com/algorandfoundation/algokit-cli`
2. Install pre-requisites:

   - Manually:
     - Install `Python` - [Link](https://www.python.org/downloads/): The minimum required version is `3.10`, but `3.11` is recommended.)
     - Install `Poetry` - [Link](https://python-poetry.org/docs/#installation): The minimum required version is `1.2`.
     - If you're not using PyCharm, then run `poetry install` in the repository root directory (this should set up `.venv` and install all Python dependencies - PyCharm will do this for you on startup)
   - Via AlgoKit CLI:

     - [Install AlgoKit CLI](./README.md#install) and run `algokit bootstrap poetry` in the root directory
     - Install `tealer` - by running `pipx install tealer==0.1.2`. This is a prerequisite to running `pytest`, tealer is a third party tool for static analysis of TEAL code, algokit uses it in `task analyse` command. AlgoKit uses `pytest-xdist` to speed up the test suite execution by running tests in parallel, this requires `tealer` to be installed globally to avoid race conditions.

3. Install pre-commit hooks (optional but recommended):

   [pre-commit](https://pre-commit.com/) is configured in this repository. To enable it, make sure that `poetry install` has been run and the virtual-env is activated by running `poetry shell`. Then execute `pre-commit install` to install the git hook scripts.

   Once it is done, git will ensure formatting, linting, and static typing (via `mypy`) is correct when you perform a commit.

4. Open the project and start debugging / developing via:

   - VS Code

     1. Open the repository root in VS Code
     2. Install recommended extensions
     3. Hit F5 (or whatever you have debug mapped to) and it should start running with breakpoint debugging

        > **Note**
        > The first time you run, VS Code may prompt you to select the Python Interpreter, or if you are having issues running you may need to select it via the `Python: Select Interpreter` pallette command. You should select the Python Interpreter with the ./.venv path)

   - IDEA (e.g. PyCharm)
     1. Open the repository root in the IDE
     2. Hit Shift+F9 (or whatever you have debug mapped to) and it should start running with breakpoint debugging
   - Other
     1. Open the repository root in your text editor of choice
     2. In a terminal run `poetry shell`
     3. Run `./debug.py` through your debugger of choice
   - In each of the above cases, an `args.in` file will be created in the source root.
     Each line will be executed in order, with the arguments passed to the cli.
     For example, you could have:

     ```
     version
     --help
     version --help
     ```

     Not a terribly useful sequence of commands, but hopefully this helps illustrate the usage.

### Subsequently

1. If you update to the latest source code and there are new dependencies you will need to run `poetry install` again
2. Follow step 3 above

### Documentation

Markdown documentation can be found within the docs directory of the repo, there is a mixture of handwritten documentation and autogenerated documentation for the CLI tool itself. To autogenerate the CLI documentation from the click source execute `poe docs`, note: this command won't work on Windows.

The CLI docs are generated using Sphinx, and its configuration can be found in `docs\sphinx`. The generated Markdown output is post processed to add a Table of Contents and top level title and the final Markdown is output to `docs\cli`. The commands to achieve this are defined in `pyproject.toml` under `[tool.poe.tasks]`

### Libraries and Tools

AlgoKit uses Python as a main language and many Python libraries and tools. This section lists all of them with a tiny brief.

- [Poetry](https://python-poetry.org/): Python packaging and dependency management.
- [pipx](https://github.com/pypa/pipx): Install and Run Python Applications in Isolated Environments
- [Click](https://palletsprojects.com/p/click/): A Python package for creating beautiful command line interfaces.
- [Black](https://github.com/psf/black): A Python code formatter.
- [Tox](https://tox.wiki/en/latest/): Automate and standardize testing in Python.

## Architecture decisions

As part of developing AlgoKit we are documenting key architecture decisions using [Architecture Decision Records (ADRs)](https://adr.github.io/). The following are the key decisions that have been made thus far:

- [2022-11-14: AlgoKit sandbox approach](docs/architecture-decisions/2022-11-14_sandbox-approach.md)
- [2022-11-22: Beaker testing strategy](docs/architecture-decisions/2022-11-22_beaker-testing-strategy.md)
- [2023-01-11: HomeBrew install strategy](docs/architecture-decisions/2023-01-11_brew_install.md)
- [2023-01-11: Beaker productionisation review](docs/architecture-decisions/2023-01-11_beaker_productionisation_review.md)
